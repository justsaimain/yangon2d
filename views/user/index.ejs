<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0 , user-scalable=no"
    />
    <title>Yangon 2D | Home</title>
    <link rel="stylesheet" href="home.css" />
  </head>
  <body>
    <header>
      <div>
        <h1 class="main-title">Yangon 2D</h1>
      </div>
    </header>
    <main>
      <div class="top-div">
        <div class="live-number">
          <h1 id="result-data">--</h1>
          <p id="date-time-data">ðŸ•¥ Updated 20-07-2022 10:30:00</p>
        </div>
        <div class="live-board">
          <div class="board">
            <h3>BUY</h3>
            <p id="buy-data">--</p>
          </div>
          <div class="divider"></div>
          <div class="board">
            <h3>SELL</h3>
            <p id="sell-data">--</p>
          </div>
        </div>
      </div>
      <div class="bottom-div">
        <% if (alert) { %>
        <div class="alert-div">
          <p id="alert-text"><%= alert %></p>
        </div>
        <% } %>
        <p>Today Results</p>
        <div class="today-board">
          <% if (todayData.length > 0) { %> <% todayData.forEach(data => { %>
          <div class="today-board-result">
            <p>
              <% if (data.time !== "12:00 PM") { %> &nbsp; <% } %> <%= data.time
              %>
            </p>
            <p><%= data.buy %></p>
            <p><%= data.sell %></p>
            <p><%= data.result %></p>
          </div>
          <% }) %> <% } else {%>
          <p style="text-align: center; color: #808080">
            Next result will be out soon...
          </p>
          <% } %>
        </div>
        <div class="actions">
          <button class="result-btn">
            <img
              style="margin-right: 10px"
              src="voting.png"
              width="25"
              height="25"
              alt=""
            />
            <span>Result History</span>
          </button>
        </div>
      </div>
    </main>
    <script>
      function onTheHourFunction() {
        var date = new Date();
        const time = date.toLocaleString("en-US", {
          hour: "numeric",
          minute: "numeric",
          hour12: true,
        });
        console.log("Time : " + time);
        getTodayData();
      }

      function getLiveData() {
        let xmlHttp = null;
        xmlHttp = new XMLHttpRequest();
        xmlHttp.open("GET", "/api/live", false);
        xmlHttp.send(null);
        let data = JSON.parse(xmlHttp.response);
        document.getElementById("buy-data").innerText = data.buy;
        document.getElementById("sell-data").innerText = data.sell;
        document.getElementById("result-data").innerText = data.result;
        document.getElementById("date-time-data").innerText =
          "ðŸ•¥ Updated " + data.date_time;
      }

      function getTodayData() {
        let xmlHttp = null;
        xmlHttp = new XMLHttpRequest();
        xmlHttp.open("GET", "/api/today", false);
        xmlHttp.send(null);
        let data = JSON.parse(xmlHttp.response);
        console.log("Working on exactly on hour");
        console.log("Today data", data);
        location.href = "/";
      }

      setInterval(function () {
        const date = new Date();
        const hour = date.getHours();
        const minute = date.getMinutes();
        const second = date.getSeconds();

        // console.log(
        //   `${hour.toString()} - ${minute.toString()} - ${second.toString()}`
        // );
        if (
          hour.toString() === "9" &&
          minute.toString() === "0" &&
          second.toString() === "0"
        ) {
          onTheHourFunction();
        }
        if (
          hour.toString() === "12" &&
          minute.toString() === "0" &&
          second.toString() === "0"
        ) {
          onTheHourFunction();
        }
        if (
          hour.toString() === "15" &&
          minute.toString() === "0" &&
          second.toString() === "0"
        ) {
          onTheHourFunction();
        }
        if (
          hour.toString() === "17" &&
          minute.toString() === "0" &&
          second.toString() === "0"
        ) {
          onTheHourFunction();
        }
        if (
          hour.toString() === "20" &&
          minute.toString() === "0" &&
          second.toString() === "0"
        ) {
          onTheHourFunction();
        }
      }, 1000);

      setInterval(() => {
        getLiveData();
      }, 5000);
    </script>
  </body>
</html>
